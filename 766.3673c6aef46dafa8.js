"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[766],{81360:(U,w,a)=>{a.d(w,{u:()=>Z});var g,T=a(19212);class Z{transform(m,p){return m/Math.pow(10,p)}}(g=Z).\u0275fac=function(m){return new(m||g)},g.\u0275pipe=T.Yjl({name:"tokenDecimals",type:g,pure:!0,standalone:!0})},20766:(U,w,a)=>{a.d(w,{l:()=>b});var T=a(15861),g=a(96814),Z=a(60095),c=a(93800),m=a(84525),p=a(68890),C=a(41342),l=a(20553);function P(e){return new Promise(o=>{setTimeout(()=>{o()},e)})}var h,q=a(54931),F=a(81360),t=a(19212),O=a(98065),k=a(50167),J=a(14391),N=a(41767);function y(e,o){if(1&e&&(t.TgZ(0,"div",7)(1,"b"),t._uU(2,"Unable to sign transaction"),t.qZA(),t.TgZ(3,"p"),t._uU(4),t.qZA()()),2&e){const n=t.oxw(2);t.xp6(4),t.Oqu(n.errorText)}}function I(e,o){1&e&&(t.TgZ(0,"div"),t._UZ(1,"ion-progress-bar",9),t.TgZ(2,"div",10),t._uU(3," Estimating... "),t.qZA()())}function H(e,o){1&e&&(t.TgZ(0,"ion-content",17),t._uU(1,"You are required to complete a transfer of ATOM to generate an inscription. This self-transaction will send 0.000001 ATOM from the inscribing address back to the same address. Since the amount is refunded, it is not listed as a fee"),t.qZA())}function S(e,o){if(1&e&&(t.TgZ(0,"table")(1,"tr")(2,"td",11),t._uU(3,"Cosmos Hub"),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.ALo(6,"number"),t.ALo(7,"tokenDecimals"),t.qZA()(),t.TgZ(8,"tr")(9,"td",11),t._uU(10,"Metaprotocol"),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.ALo(13,"number"),t.qZA()(),t.TgZ(14,"tr")(15,"td",12),t._uU(16,"Estimated total"),t.qZA(),t.TgZ(17,"td",13),t._uU(18),t.ALo(19,"number"),t.ALo(20,"tokenDecimals"),t.TgZ(21,"div",14),t._UZ(22,"ion-icon",15),t.TgZ(23,"ion-popover",16),t.YNc(24,H,2,0,"ng-template"),t.qZA()()()()()),2&e){const n=t.oxw(3);t.xp6(5),t.hij("",t.xi3(6,3,t.xi3(7,6,n.chainFee,6),"1.6-6")," ATOM"),t.xp6(7),t.hij("",t.xi3(13,9,n.protocolFee,"1.6-6")," ATOM"),t.xp6(6),t.hij(" ",t.xi3(19,12,t.xi3(20,15,n.chainFee+n.protocolFeeAbsolute,6),"1.6-6")," ATOM ")}}function Y(e,o){if(1&e&&(t.TgZ(0,"ion-row")(1,"ion-col")(2,"div",8)(3,"h4"),t._uU(4,"Estimated fee breakdown"),t.qZA(),t.YNc(5,I,4,0,"div",1)(6,S,25,18,"table",1),t.qZA()()()),2&e){const n=t.oxw(2);t.xp6(5),t.Q6J("ngIf",n.isSimulating),t.xp6(1),t.Q6J("ngIf",!n.isSimulating)}}function D(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"ion-row")(1,"ion-col")(2,"div",5)(3,"ion-button",18),t.NdJ("click",function(){t.CHM(n);const i=t.oxw(2);return t.KtG(i.submit())}),t._uU(4),t.qZA(),t._UZ(5,"br"),t.TgZ(6,"ion-button",19),t.NdJ("click",function(){t.CHM(n);const i=t.oxw(2);return t.KtG(i.cancel())}),t._uU(7,"Cancel"),t.qZA()()()()}if(2&e){const n=t.oxw(2);t.xp6(4),t.Oqu("error"==n.state?"Retry":"Continue")}}const v=()=>({path:"../assets/lottie/scan.json"});function Q(e,o){if(1&e&&(t.TgZ(0,"ion-grid")(1,"ion-row")(2,"ion-col")(3,"div",3),t._UZ(4,"ng-lottie",4),t.qZA()()(),t.TgZ(5,"ion-row")(6,"ion-col",5)(7,"h2"),t._uU(8,"Sign and submit transaction"),t.qZA(),t.TgZ(9,"p"),t._uU(10," You are about to inscribe permanently on the Cosmos Hub."),t._UZ(11,"br"),t._uU(12,"This can "),t.TgZ(13,"b"),t._uU(14,"not"),t.qZA(),t._uU(15," be undone. "),t.qZA(),t.YNc(16,y,5,1,"div",6),t.qZA()(),t.YNc(17,Y,7,2,"ion-row",1)(18,D,8,1,"ion-row",1),t.qZA()),2&e){const n=t.oxw();t.xp6(4),t.Q6J("options",t.DdM(4,v)),t.xp6(12),t.Q6J("ngIf",""!=n.errorText),t.xp6(1),t.Q6J("ngIf",""==n.errorText),t.xp6(1),t.Q6J("ngIf",!n.isSimulating)}}function L(e,o){1&e&&(t.TgZ(0,"ion-grid",20)(1,"ion-row")(2,"ion-col",21)(3,"h2"),t._uU(4,"Preparing the transaction..."),t.qZA()()(),t.TgZ(5,"ion-row")(6,"ion-col")(7,"div",3),t._UZ(8,"ng-lottie",4),t.qZA()()()()),2&e&&(t.xp6(8),t.Q6J("options",t.DdM(1,v)))}function E(e,o){1&e&&(t.TgZ(0,"ion-grid",20)(1,"ion-row")(2,"ion-col",21)(3,"h2"),t._uU(4,"Approve the transaction..."),t.qZA()()(),t.TgZ(5,"ion-row")(6,"ion-col")(7,"div",3),t._UZ(8,"ng-lottie",4),t.qZA()()()()),2&e&&(t.xp6(8),t.Q6J("options",t.DdM(1,v)))}function j(e,o){if(1&e&&(t.TgZ(0,"div",7)(1,"b"),t._uU(2,"Unable to sign transaction"),t.qZA(),t.TgZ(3,"p"),t._uU(4),t.qZA()()),2&e){const n=t.oxw(2);t.xp6(4),t.Oqu(n.errorText)}}function G(e,o){if(1&e&&(t.TgZ(0,"p")(1,"a",23),t._uU(2,"Open on Mintscan"),t.qZA()()),2&e){const n=t.oxw(2);t.xp6(1),t.hYB("href","",n.explorerTxUrl,"",n.txHash,"",t.LSH)}}const A=()=>({path:"../assets/lottie/hourglass.json"});function z(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"ion-grid",20)(1,"ion-row")(2,"ion-col")(3,"div",3),t._UZ(4,"ng-lottie",4),t.qZA()()(),t.TgZ(5,"ion-row")(6,"ion-col",21)(7,"h2"),t._uU(8,"Waiting for transaction"),t.qZA(),t.TgZ(9,"p"),t._uU(10,"Your inscription has been submitted and"),t._UZ(11,"br"),t._uU(12,"waiting to be added to the next block"),t.qZA(),t.YNc(13,j,5,1,"div",6),t.qZA()(),t.TgZ(14,"ion-row")(15,"ion-col",22)(16,"h3"),t._uU(17,"Transaction hash"),t.qZA(),t.TgZ(18,"p"),t._uU(19),t.qZA(),t.YNc(20,G,3,2,"p",1),t.qZA()(),t.TgZ(21,"ion-row")(22,"ion-col")(23,"div",5)(24,"ion-button",19),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.cancel())}),t._uU(25,"Close"),t.qZA()()()()()}if(2&e){const n=t.oxw();t.xp6(4),t.Q6J("options",t.DdM(4,A)),t.xp6(9),t.Q6J("ngIf",""!=n.errorText),t.xp6(6),t.Oqu(n.txHash),t.xp6(1),t.Q6J("ngIf",n.txHash)}}function K(e,o){if(1&e&&(t.TgZ(0,"p")(1,"a",23),t._uU(2,"Open on Mintscan"),t.qZA()()),2&e){const n=t.oxw(2);t.xp6(1),t.hYB("href","",n.explorerTxUrl,"",n.txHash,"",t.LSH)}}function B(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"ion-grid")(1,"ion-row")(2,"ion-col")(3,"div",24),t._UZ(4,"ng-lottie",4),t.qZA()()(),t.TgZ(5,"ion-row")(6,"ion-col",5)(7,"h2"),t._uU(8,"Indexing"),t.qZA(),t.TgZ(9,"p"),t._uU(10,"Your inscription has been created on-chain, waiting for indexer"),t.qZA()()(),t.TgZ(11,"ion-row")(12,"ion-col",22)(13,"h3"),t._uU(14,"Transaction hash"),t.qZA(),t.TgZ(15,"p"),t._uU(16),t.qZA(),t.YNc(17,K,3,2,"p",1),t.qZA()(),t.TgZ(18,"ion-row")(19,"ion-col")(20,"div",5)(21,"ion-button",19),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.cancel())}),t._uU(22,"Close"),t.qZA()()()()()}if(2&e){const n=t.oxw();t.xp6(4),t.Q6J("options",t.DdM(3,A)),t.xp6(12),t.Oqu(n.txHash),t.xp6(1),t.Q6J("ngIf",n.txHash)}}function R(e,o){if(1&e&&(t.TgZ(0,"p")(1,"a",23),t._uU(2,"Open on Mintscan"),t.qZA()()),2&e){const n=t.oxw(2);t.xp6(1),t.hYB("href","",n.explorerTxUrl,"",n.txHash,"",t.LSH)}}const W=()=>({path:"../assets/lottie/error.json"});function X(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"ion-grid")(1,"ion-row")(2,"ion-col")(3,"div",24),t._UZ(4,"ng-lottie",4),t.qZA()()(),t.TgZ(5,"ion-row")(6,"ion-col",5)(7,"h2"),t._uU(8,"Inscription failed"),t.qZA(),t.TgZ(9,"p"),t._uU(10,"Your inscription was created on-chain, but failed to be added to Asteroid."),t._UZ(11,"br"),t._uU(12,"The reason for the failure was: "),t.qZA(),t.TgZ(13,"p",25),t._uU(14),t.qZA()()(),t.TgZ(15,"ion-row")(16,"ion-col",22)(17,"h3"),t._uU(18,"Transaction hash"),t.qZA(),t.TgZ(19,"p"),t._uU(20),t.qZA(),t.YNc(21,R,3,2,"p",1),t.qZA()(),t.TgZ(22,"ion-row")(23,"ion-col")(24,"div",5)(25,"ion-button",19),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.cancel())}),t._uU(26,"Close"),t.qZA()()()()()}if(2&e){const n=t.oxw();t.xp6(4),t.Q6J("options",t.DdM(4,W)),t.xp6(10),t.Oqu(n.errorText),t.xp6(6),t.Oqu(n.txHash),t.xp6(1),t.Q6J("ngIf",n.txHash)}}function V(e,o){if(1&e&&(t.TgZ(0,"p")(1,"a",23),t._uU(2,"Open on Mintscan"),t.qZA()()),2&e){const n=t.oxw(2);t.xp6(1),t.hYB("href","",n.explorerTxUrl,"",n.txHash,"",t.LSH)}}const $=()=>({path:"../assets/lottie/success.json",loop:!1});function tt(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"ion-grid")(1,"ion-row")(2,"ion-col")(3,"div",24),t._UZ(4,"ng-lottie",4),t.qZA()()(),t.TgZ(5,"ion-row")(6,"ion-col",5)(7,"h2"),t._uU(8,"Transaction complete"),t.qZA(),t.TgZ(9,"p"),t._uU(10,"Your inscription is now on-chain and viewable on Asteroid"),t.qZA()()(),t.TgZ(11,"ion-row")(12,"ion-col",5)(13,"div")(14,"ion-button",26),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.viewInscription())}),t._uU(15),t.qZA()()()(),t.TgZ(16,"ion-row")(17,"ion-col",22)(18,"h3"),t._uU(19,"Transaction hash"),t.qZA(),t.TgZ(20,"p"),t._uU(21),t.qZA(),t.YNc(22,V,3,2,"p",1),t.qZA()(),t.TgZ(23,"ion-row")(24,"ion-col")(25,"div",5)(26,"ion-button",19),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.cancel())}),t._uU(27,"Close"),t.qZA()()()()()}if(2&e){const n=t.oxw();t.xp6(4),t.Q6J("options",t.DdM(4,$)),t.xp6(11),t.Oqu(n.resultCTA),t.xp6(6),t.Oqu(n.txHash),t.xp6(1),t.Q6J("ngIf",n.txHash)}}class b{constructor(o,n,r,i,u){this.walletService=o,this.chainService=n,this.modalCtrl=r,this.router=i,this.protocolService=u,this.resultCTA="View inscription",this.routerLink="",this.urn="",this.messages=[],this.messagesJSON=[],this.overrideFee=0,this.isSimulating=!0,this.errorText="",this.txHash="",this.state="sign",this.explorerTxUrl=l.N.api.explorer,this.currentChain=l.N.chain,this.gasEstimate=parseInt(l.N.fees.chain.gasLimit),this.chainFee=this.gasEstimate*this.currentChain.feeCurrencies[0].gasPriceStep.average/1e6,this.protocolFee=.005,this.protocolFeeAbsolute=.005,this.metaprotocol="inscription",this.metaprotocolAction="inscribe",this.urn="",this.metadata="",this.data="",this.txHash="",(0,m.a)({checkmark:p.d29,closeOutline:p.fID,close:p.xvD,helpCircleOutline:p.Sm}),this.chain=(0,q.qo)(l.N.api.endpoint)}ngOnInit(){var o=this;return(0,T.Z)(function*(){o.state="sign",o.errorText="",o.isSimulating=!0;const n={metaprotocol:{receiver:l.N.fees.protocol[o.metaprotocol][o.metaprotocolAction].receiver,denom:l.N.fees.protocol[o.metaprotocol][o.metaprotocolAction].denom,amount:l.N.fees.protocol[o.metaprotocol][o.metaprotocolAction].amount},chain:{denom:o.currentChain.feeCurrencies[0].coinMinimalDenom,amount:"0"},gasLimit:l.N.fees.chain.gasLimit};o.overrideFee>0&&(n.metaprotocol.amount=o.overrideFee.toString()),o.protocolFee=parseInt(n.metaprotocol.amount)/10**o.currentChain.feeCurrencies[0].coinDecimals,o.protocolFeeAbsolute=parseInt(n.metaprotocol.amount),o.gasEstimate=parseInt(l.N.fees.chain.gasLimit);try{const r=yield o.walletService.createSimulated(o.urn,o.metadata,o.data,n,o.messagesJSON),i=yield o.chainService.simulateTransaction(r);i&&(o.gasEstimate=parseInt(i.gas_used),o.gasEstimate=o.gasEstimate+.6*o.gasEstimate,o.chainFee=o.gasEstimate*o.currentChain.feeCurrencies[0].gasPriceStep.average/1e6,o.chainFee=o.chainFee+.4*o.chainFee,o.chainFee=o.chainFee*10**o.currentChain.feeCurrencies[0].coinDecimals)}catch(r){console.error(r),o.errorText=r,o.state="error"}o.isSimulating=!1})()}submit(){var o=this;return(0,T.Z)(function*(){if("error"==o.state&&(yield o.ngOnInit()),"error"==o.state)return;const n={metaprotocol:{receiver:l.N.fees.protocol[o.metaprotocol][o.metaprotocolAction].receiver,denom:l.N.fees.protocol[o.metaprotocol][o.metaprotocolAction].denom,amount:l.N.fees.protocol[o.metaprotocol][o.metaprotocolAction].amount},chain:{denom:o.currentChain.feeCurrencies[0].coinMinimalDenom,amount:o.chainFee.toFixed(0)},gasLimit:o.gasEstimate.toFixed(0)};o.protocolFeeAbsolute>0&&(n.metaprotocol.amount=o.protocolFeeAbsolute.toString());try{o.state="sign-prepare";const d=yield o.walletService.sign(o.urn,o.metadata,o.data,n,o.messages,()=>o.state="sign-approve");o.state="sign-prepare";const{protocol:f,operation:ot,params:M}=o.protocolService.parseURN(o.urn);if("cft20"==f&&"buy"==ot){var r;const _=yield o.chain("query")({token_open_position:[{where:{id:{_eq:M.get("ord")},token:{ticker:{_eq:M.get("tic")}}}},{is_cancelled:!0,is_filled:!0}]}),s=null==_||null===(r=_.token_open_position)||void 0===r?void 0:r[0];if(null!=s&&s.is_cancelled||null!=s&&s.is_filled)throw"This listing has already been "+(null!=s&&s.is_cancelled?"cancelled":"filled")+". Your transaction was aborted and not broadcast."}o.state="submit",o.txHash=yield o.walletService.broadcast(d);for(let _=0;_<180;_++){yield P(1e3);try{if("submit"==o.state){const s=yield o.chainService.fetchTransaction(o.txHash);s&&0==s.code&&(o.state="success-onchain")}else{const s=yield o.chain("query")({transaction:[{where:{hash:{_eq:o.txHash}}},{id:!0,hash:!0,status_message:!0}]});if(s.transaction.length>0){var i,u;if(o.state="success-indexer","success"==(null===(i=s.transaction[0].status_message)||void 0===i?void 0:i.toLowerCase())){o.state="success-inscribed";break}if(null!==(u=s.transaction[0].status_message)&&void 0!==u&&u.toLowerCase().includes("error")){o.state="failed",o.errorText=o.mapToHumanError(s.transaction[0].status_message);break}}}}catch(s){console.error(s)}}}catch(d){var x;o.state="error",o.errorText=null!==(x=null==d?void 0:d.message)&&void 0!==x?x:d}})()}cancel(){this.modalCtrl.dismiss()}mapToHumanError(o){return o.includes("inscription_content_hash")?"Your inscription contains content already inscribed. Duplicates are not allowed.":o.includes("order by id")&&o.includes("doesn't exist")?"The sell order has already been filled or removed":o}viewInscription(){"string"==typeof this.routerLink?this.router.navigate([this.routerLink,this.txHash]):this.router.navigate(this.routerLink),this.modalCtrl.dismiss()}}(h=b).\u0275fac=function(o){return new(o||h)(t.Y36(O.X),t.Y36(k.l),t.Y36(c.IN),t.Y36(J.F0),t.Y36(N._))},h.\u0275cmp=t.Xpm({type:h,selectors:[["app-transaction-flow-modal"]],inputs:{resultCTA:"resultCTA",routerLink:"routerLink",urn:"urn",metadata:"metadata",data:"data",messages:"messages",messagesJSON:"messagesJSON",overrideFee:"overrideFee"},standalone:!0,features:[t.jDz],decls:9,vars:7,consts:[["mode","md",1,"main-content"],[4,"ngIf"],["class","mt-5",4,"ngIf"],[1,"animation","mx-auto"],[3,"options"],[1,"text-center"],["class","mt-3 warning-box text-left",4,"ngIf"],[1,"mt-3","warning-box","text-left"],[1,"fees"],["type","indeterminate"],[1,"note"],[1,"label"],[1,"label","total"],[1,"total","shifted"],[1,"icon-trigger"],["id","click-trigger","name","help-circle-outline"],["trigger","click-trigger","triggerAction","click"],[1,"main-content","ion-padding"],["color","success",1,"mt-3",3,"click"],["color","primary","fill","clear",1,"mt-3",3,"click"],[1,"mt-5"],[1,"text-center","mt-5"],[1,"text-center","note"],["target","_blank",3,"href"],[1,"animation","large","mx-auto","p-0","m-0"],[1,"color-orange"],["color","primary",3,"click"]],template:function(o,n){1&o&&(t.TgZ(0,"ion-content",0)(1,"div"),t.YNc(2,Q,19,5,"ion-grid",1)(3,L,9,2,"ion-grid",2)(4,E,9,2,"ion-grid",2)(5,z,26,5,"ion-grid",2)(6,B,23,4,"ion-grid",1)(7,X,27,5,"ion-grid",1)(8,tt,28,5,"ion-grid",1),t.qZA()()),2&o&&(t.xp6(2),t.Q6J("ngIf","sign"==n.state||"error"==n.state),t.xp6(1),t.Q6J("ngIf","sign-prepare"==n.state),t.xp6(1),t.Q6J("ngIf","sign-approve"==n.state),t.xp6(1),t.Q6J("ngIf","submit"==n.state),t.xp6(1),t.Q6J("ngIf","success-onchain"==n.state||"success-indexer"==n.state),t.xp6(1),t.Q6J("ngIf","failed"==n.state),t.xp6(1),t.Q6J("ngIf","success-inscribed"==n.state))},dependencies:[c.Pc,c.YG,c.wI,c.W2,c.jY,c.gu,c.X7,c.Nd,c.d8,g.ez,g.O5,g.JJ,Z.u5,C.e$,F.u],styles:["[_ngcontent-%COMP%]:root{border-radius:10px!important}[_nghost-%COMP%]{border-radius:10px!important}ion-content[_ngcontent-%COMP%]{--background: hsla(0, 0%, 100%, .05) !important;background-color:#ffffff0d!important;-webkit-backdrop-filter:blur(50px);backdrop-filter:blur(50px);height:100%;border-radius:10px;padding:20px;transition:all .2s ease-in-out}.mw-400[_ngcontent-%COMP%]{max-width:400px}.animation[_ngcontent-%COMP%]{max-width:150px}.animation.large[_ngcontent-%COMP%]{max-width:200px;height:200px}ion-col.note[_ngcontent-%COMP%]{font-size:14px;color:#a7a7a7}ion-col.note[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:14px;color:#ebebeb}ion-col.note[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--color-teal)}div.fees[_ngcontent-%COMP%]{font-size:14px;color:#a7a7a7;max-width:270px;margin-left:auto;margin-right:auto}div.fees[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:16px;color:#ebebeb;text-align:center}div.fees[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-right:12px;padding-bottom:4px}div.fees[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td.label[_ngcontent-%COMP%]{text-align:left;font-weight:700}div.fees[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td.total[_ngcontent-%COMP%]{padding-top:10px;border-top:1px solid #a7a7a7}div.icon-trigger[_ngcontent-%COMP%]{display:inline;font-size:18px;position:relative}div.icon-trigger[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{top:8px;position:relative;padding:5px;cursor:pointer}ion-popover[_ngcontent-%COMP%]{--background: hsla(0, 0%, 100%, .05) !important}.shifted[_ngcontent-%COMP%]{position:relative;top:-6px}"]})}}]);