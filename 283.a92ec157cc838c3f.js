"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[283],{99959:(R,E,l)=>{l.d(E,{J:()=>p});var f,b=l(19212);class p{constructor(){this.version="v1"}buildURN(u,v,A){const P=Array.from(A,([Z,S])=>`${Z}=${S}`).join(",");return`urn:marketplace:${u}@${this.version};${v}$${P}`}}(f=p).\u0275fac=function(u){return new(u||f)},f.\u0275prov=b.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"})},23443:(R,E,l)=>{l.d(E,{N:()=>v});var u,b=l(15861),f=l(54931),p=l(20553),s=l(19212);class v{constructor(){}fetchBaseTokenUSDPrice(){return(0,b.Z)(function*(){return(yield(0,f.qo)(p.N.api.endpoint)("query")({status:[{where:{chain_id:{_eq:p.N.chain.chainId}}},{base_token:!0,base_token_usd:!0}]})).status[0].base_token_usd||0})()}}(u=v).\u0275fac=function(P){return new(P||u)},u.\u0275prov=s.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"})},29086:(R,E,l)=>{l.d(E,{t:()=>B});var C,b=l(15861),f=l(96814),p=l(60095),s=l(93800),u=l(84525),v=l(68890),A=l(20553),P=l(54931),U=l(81260),Z=l(46711),S=l(20766),q=l(81360),D=l(82785),e=l(19212),N=l(98065),F=l(50167),J=l(14391),K=l(99959);function L(h,c){if(1&h&&(e.TgZ(0,"div",22),e._uU(1),e.ALo(2,"number"),e.ALo(3,"stripSpaces"),e.ALo(4,"stripSpaces"),e.qZA()),2&h){const a=e.oxw();e.xp6(1),e.hij(" You will be selling your tokens for a total of ",e.xi3(2,1,e.lcZ(3,4,a.sellForm.value.basic.amount)*e.lcZ(4,6,a.sellForm.value.basic.price),"1.2-6")," ATOM ")}}function W(h,c){if(1&h&&(e.TgZ(0,"div",23),e._uU(1),e.ALo(2,"number"),e.qZA()),2&h){const a=e.oxw();e.xp6(1),e.hij(" The minimum value of the listing must be at least ",e.xi3(2,1,a.minTradeSize,"1.2-6")," ATOM ")}}function V(h,c){1&h&&(e.TgZ(0,"div",24)(1,"ion-text",25),e._uU(2,"Loading balance..."),e.qZA()())}function Y(h,c){if(1&h&&(e.TgZ(0,"div",24)(1,"ion-text",25),e._uU(2),e.ALo(3,"number"),e.qZA()()),2&h){const a=e.oxw();e.xp6(2),e.AsE("You can't list more tokens than you have available. Your balance is ",e.xi3(3,2,a.senderBalance,"1.2-6")," ",a.ticker,"")}}class B{constructor(c,a,x,I,M,y){this.walletService=c,this.chainService=a,this.modalCtrl=x,this.router=I,this.builder=M,this.protocolService=y,this.ticker="tokens",this.minTradeSize=A.N.fees.protocol.marketplace["list.cft20"].minTradeSize,this.senderBalance=0,this.minDepositAbsolute=A.N.fees.protocol.marketplace["list.cft20"].minDepositAbsolute,this.minDepositPercent=A.N.fees.protocol.marketplace["list.cft20"].minDepositPercent,this.maxDepositPercent=A.N.fees.protocol.marketplace["list.cft20"].maxDepositPercent,this.minTimeout=A.N.fees.protocol.marketplace["list.cft20"].minTimeout,this.maxTimeout=A.N.fees.protocol.marketplace["list.cft20"].maxTimeout,this.loadingBalance=!0,this.maskPredicate=function(){var O=(0,b.Z)(function*(T){return T.getInputElement()});return function(T){return O.apply(this,arguments)}}(),this.decimalMaskPredicate=function(){var O=(0,b.Z)(function*(T){return T.getInputElement()});return function(T){return O.apply(this,arguments)}}(),(0,u.a)({checkmark:v.d29,closeOutline:v.fID,close:v.xvD}),this.sellForm=this.builder.group({basic:this.builder.group({amount:[10,[p.kI.required,p.kI.pattern("^[0-9. ]*$")]],price:[.1,[p.kI.required,p.kI.pattern("^[0-9. ]*$")]],minDeposit:[this.minDepositPercent,[p.kI.required,p.kI.min(this.minDepositPercent),p.kI.max(this.maxDepositPercent),p.kI.pattern("^[0-9. ]*$")]],timeoutBlocks:[this.minTimeout,[p.kI.required,p.kI.min(this.minTimeout),p.kI.max(this.maxTimeout),p.kI.pattern("^[0-9 ]*$")]]})}),this.numberMask=(0,U.f8)({decimalSeparator:".",thousandSeparator:" ",precision:0,min:1}),this.decimalMask=(0,U.f8)({decimalSeparator:".",thousandSeparator:" ",precision:6,min:0})}ngOnInit(){var c=this;return(0,b.Z)(function*(){const a=yield c.walletService.getAccount(),x=(0,P.qo)(A.N.api.endpoint),I=yield x("query")({token:[{where:{ticker:{_eq:c.ticker}}},{id:!0,decimals:!0,last_price_base:!0}]}),M=yield x("query")({token_holder:[{where:{address:{_eq:a.address},token_id:{_eq:I.token[0].id}}},{amount:!0}]});c.loadingBalance=!1,M.token_holder.length>0&&(c.senderBalance=q.u.prototype.transform(parseInt(M.token_holder[0].amount),I.token[0].decimals))})()}submit(){var c=this;return(0,b.Z)(function*(){if(!c.sellForm.valid)return void c.sellForm.markAllAsTouched();c.modalCtrl.dismiss();const a=D.C.prototype.transform(c.sellForm.value.basic.amount).toString(),x=D.C.prototype.transform(c.sellForm.value.basic.price).toString(),M=parseFloat(D.C.prototype.transform(c.sellForm.value.basic.minDeposit).toString())/100,y=D.C.prototype.transform(c.sellForm.value.basic.timeoutBlocks).toString(),O=new Map([["tic",c.ticker],["amt",a],["ppt",x],["mindep",M.toString()],["to",y]]);let T=parseFloat(a)*parseFloat(x)*M;T<c.minDepositAbsolute&&(T=c.minDepositAbsolute),T*=10**6,T=Math.floor(T);const z=c.protocolService.buildURN(A.N.chain.chainId,"list.cft20",O);(yield c.modalCtrl.create({keyboardClose:!0,backdropDismiss:!1,component:S.l,componentProps:{urn:z,metadata:null,data:null,routerLink:["/app/manage/token",c.ticker],resultCTA:"View transaction",metaprotocol:"marketplace",metaprotocolAction:"list.cft20",overrideFee:T}})).present()})()}cancel(){this.modalCtrl.dismiss()}}(C=B).\u0275fac=function(c){return new(c||C)(e.Y36(N.X),e.Y36(F.l),e.Y36(s.IN),e.Y36(J.F0),e.Y36(p.qu),e.Y36(K.J))},C.\u0275cmp=e.Xpm({type:C,selectors:[["app-sell-modal"]],inputs:{ticker:"ticker"},standalone:!0,features:[e.jDz],decls:66,vars:39,consts:[["mode","md",1,"main-content"],[1,"form",3,"formGroup","ngSubmit"],[1,"p-3"],[1,"text-center"],["size-md","6","size","12"],["formGroupName","basic"],[1,"mt-4"],["label","Amount to sell","labelPlacement","stacked","fill","outline","placeholder","10","formControlName","amount",3,"maskito","maskitoElement"],["label","Price per token","labelPlacement","stacked","fill","outline","placeholder","10","formControlName","price",3,"maskito","maskitoElement"],["toggleIconSlot","start"],["slot","header"],["slot","content",1,"ion-padding"],[1,"note"],[1,"mt-4","w-50"],["label","Minimum deposit required","labelPlacement","stacked","fill","outline","placeholder","10","formControlName","minDeposit",3,"maskito","maskitoElement"],["label","Timout in blocks","labelPlacement","stacked","fill","outline","placeholder","5","formControlName","timeoutBlocks",3,"maskito","maskitoElement"],["class","p-3 mt-4 mb-4 confirmation",4,"ngIf"],["class","p-3 mt-4 mb-4 color-danger",4,"ngIf"],["class","p-3 mt-4 mb-4",4,"ngIf"],[1,"action"],["color","success","type","submit",3,"disabled"],["color","primary","fill","clear",3,"click"],[1,"p-3","mt-4","mb-4","confirmation"],[1,"p-3","mt-4","mb-4","color-danger"],[1,"p-3","mt-4","mb-4"],["color","warning"]],template:function(c,a){1&c&&(e.TgZ(0,"ion-content",0)(1,"form",1),e.NdJ("ngSubmit",function(){return a.submit()}),e.TgZ(2,"ion-grid",2)(3,"ion-row")(4,"ion-col",3)(5,"h2"),e._uU(6),e.qZA()()(),e.TgZ(7,"ion-row")(8,"ion-col")(9,"p"),e._uU(10," This transaction will list your tokens for sale"),e._UZ(11,"br"),e._uU(12,"You'll only receive the ATOM from the sale should someone purchase them "),e.qZA(),e.TgZ(13,"p"),e._uU(14," Sales are final and can't be refunded. You may cancel a listing at any time before a successful reservation "),e.qZA()()(),e.TgZ(15,"ion-row")(16,"ion-col",4)(17,"div",5)(18,"div",6),e._UZ(19,"ion-input",7),e.qZA()()(),e.TgZ(20,"ion-col",4)(21,"div",5)(22,"div",6),e._UZ(23,"ion-input",8),e.qZA()()()(),e.TgZ(24,"ion-row")(25,"ion-col")(26,"ion-accordion-group")(27,"ion-accordion",9)(28,"ion-item",10)(29,"ion-label"),e._uU(30,"Advanced"),e.qZA()(),e.TgZ(31,"div",11)(32,"p",12),e._uU(33," You do not need to adjust these parameters. The defaults should suffice. "),e.qZA(),e.TgZ(34,"div",5)(35,"div",13),e._UZ(36,"ion-input",14),e.TgZ(37,"span",12),e._uU(38),e.qZA()(),e.TgZ(39,"div",13),e._UZ(40,"ion-input",15),e.TgZ(41,"span",12),e._uU(42),e.qZA()()()()()()()(),e.TgZ(43,"ion-row")(44,"ion-col"),e.YNc(45,L,5,8,"div",16),e.ALo(46,"stripSpaces"),e.ALo(47,"stripSpaces"),e.ALo(48,"stripSpaces"),e.YNc(49,W,3,4,"div",17),e.ALo(50,"stripSpaces"),e.ALo(51,"stripSpaces"),e.ALo(52,"stripSpaces"),e.YNc(53,V,3,0,"div",18)(54,Y,4,5,"div",18),e.ALo(55,"stripSpaces"),e.qZA()(),e.TgZ(56,"ion-row")(57,"ion-col")(58,"div",19)(59,"ion-button",20),e.ALo(60,"stripSpaces"),e.ALo(61,"stripSpaces"),e.ALo(62,"stripSpaces"),e._uU(63,"Confirm and list"),e.qZA(),e.TgZ(64,"ion-button",21),e.NdJ("click",function(){return a.cancel()}),e._uU(65,"Cancel"),e.qZA()()()()()()()),2&c&&(e.xp6(1),e.Q6J("formGroup",a.sellForm),e.xp6(5),e.hij("List ",a.ticker," for sale"),e.xp6(13),e.Q6J("maskito",a.decimalMask)("maskitoElement",a.maskPredicate),e.xp6(4),e.Q6J("maskito",a.decimalMask)("maskitoElement",a.maskPredicate),e.xp6(13),e.Q6J("maskito",a.decimalMask)("maskitoElement",a.maskPredicate),e.xp6(2),e.AsE("This is the minimum percent someone needs to pay to reserve the listing, ",a.minDepositPercent,"% - ",a.maxDepositPercent,"%"),e.xp6(2),e.Q6J("maskito",a.decimalMask)("maskitoElement",a.maskPredicate),e.xp6(2),e.AsE("How long a reservation will be valid for, ",a.minTimeout," - ",a.maxTimeout," blocks"),e.xp6(3),e.Q6J("ngIf",e.lcZ(46,19,a.sellForm.value.basic.amount)*e.lcZ(47,21,a.sellForm.value.basic.price)>=a.minTradeSize&&e.lcZ(48,23,a.sellForm.value.basic.amount)<=a.senderBalance),e.xp6(4),e.Q6J("ngIf",e.lcZ(50,25,a.sellForm.value.basic.amount)*e.lcZ(51,27,a.sellForm.value.basic.price)<a.minTradeSize&&e.lcZ(52,29,a.sellForm.value.basic.amount)<a.senderBalance),e.xp6(4),e.Q6J("ngIf",a.loadingBalance),e.xp6(1),e.Q6J("ngIf",!a.loadingBalance&&e.lcZ(55,31,a.sellForm.value.basic.amount)>a.senderBalance),e.xp6(5),e.Q6J("disabled",e.lcZ(60,33,a.sellForm.value.basic.amount)*e.lcZ(61,35,a.sellForm.value.basic.price)<a.minTradeSize||e.lcZ(62,37,a.sellForm.value.basic.amount)>a.senderBalance))},dependencies:[s.Pc,s.We,s.eh,s.YG,s.wI,s.W2,s.jY,s.pK,s.Ie,s.Q$,s.Nd,s.yW,s.j9,p.UX,p._Y,p.JJ,p.JL,p.sg,p.u,p.x0,f.ez,f.O5,f.JJ,p.u5,Z.U5,Z.ro,D.C],styles:["ion-content[_ngcontent-%COMP%]{--background: hsla(0, 0%, 100%, .05) !important;background-color:#ffffff0d!important;-webkit-backdrop-filter:blur(50px);backdrop-filter:blur(50px);height:100%;border-radius:10px;padding:20px;transition:all .2s ease-in-out}.confirmation[_ngcontent-%COMP%]{background-color:#0003;border-radius:10px;border:1px solid var(--color-teal)}.action[_ngcontent-%COMP%]{position:relative;bottom:20px;width:100%;text-align:center}.note[_ngcontent-%COMP%]{font-size:11px;color:#fff9}ion-list[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%], ion-list-header[_ngcontent-%COMP%], ion-label[_ngcontent-%COMP%], ion-accordion[_ngcontent-%COMP%], ion-accordion-group[_ngcontent-%COMP%]{--background: transparent;--ion-background-color: transparent !important;--background-color: transparent !important;background-color:transparent!important}ion-item[slot=header][_ngcontent-%COMP%]{color:#fff}ion-item[slot=header][_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{padding:0!important;margin:0!important}ion-accordion[_ngcontent-%COMP%]::part(expanded){background-color:#1e1e1e1a!important}ion-list-header[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{text-transform:uppercase;color:#fff;padding:0;margin:0}ion-item[_ngcontent-%COMP%]{--min-height: 25px;padding:0;--padding-bottom: 0px;--inner-padding-bottom: 0px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-left:10px;--min-height: 25px;height:20px;padding:0;color:#ccc}"]})},283:(R,E,l)=>{l.r(E),l.d(E,{TradeTokenV2Page:()=>G});var L,b=l(15861),f=l(96814),p=l(60095),s=l(93800),u=l(20553),v=l(54931),A=l(81360),P=l(20766),U=l(35116),Z=l(35768),S=l(29086),q=l(241),D=l(71255),e=l(19212),N=l(14391),F=l(99959),J=l(98065),K=l(23443),C=l(85219);function W(n,o){if(1&n&&(e.TgZ(0,"ion-content",12),e._UZ(1,"br")(2,"br")(3,"br")(4,"br")(5,"br")(6,"br")(7,"br")(8,"br")(9,"br")(10,"br"),e.TgZ(11,"h2",13),e._uU(12),e.qZA(),e._UZ(13,"br")(14,"br")(15,"br")(16,"br")(17,"br")(18,"br")(19,"br"),e.qZA()),2&n){const t=e.oxw();e.xp6(12),e.Oqu(t.loadingListing)}}function V(n,o){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(t.token.ticker)}}function Y(n,o){1&n&&(e.TgZ(0,"div",14),e._UZ(1,"ion-progress-bar",15),e.TgZ(2,"p"),e._uU(3," Loading market... "),e.qZA()())}function B(n,o){if(1&n&&(e.TgZ(0,"tr")(1,"th",31),e._uU(2,"Listing # "),e._UZ(3,"p-sortIcon",32),e.qZA(),e.TgZ(4,"th",33),e._uU(5,"ATOM per Token "),e._UZ(6,"p-sortIcon",34),e.qZA(),e.TgZ(7,"th",35),e._uU(8),e._UZ(9,"p-sortIcon",36),e.qZA(),e.TgZ(10,"th",37),e._uU(11,"Total ATOM "),e._UZ(12,"p-sortIcon",38),e.qZA(),e.TgZ(13,"th",39),e._uU(14,"Minimum Deposit "),e._UZ(15,"p-sortIcon",40),e.qZA(),e.TgZ(16,"th",41),e._uU(17,"Listed "),e._UZ(18,"p-sortIcon",42),e.qZA(),e.TgZ(19,"th"),e._uU(20,"\xa0"),e.qZA()()),2&n){const t=e.oxw(3);e.xp6(8),e.hij("",t.token.ticker," Tokens ")}}function h(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"ion-button",49),e.NdJ("click",function(){e.CHM(t);const d=e.oxw().$implicit,r=e.oxw(3);return e.KtG(r.deposit(d.marketplace_listing.transaction.hash))}),e._uU(1,"Reserve"),e.qZA()}}function c(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"ion-button",49),e.NdJ("click",function(){e.CHM(t);const d=e.oxw().$implicit,r=e.oxw(3);return e.KtG(r.buy(d.marketplace_listing.transaction.hash))}),e._uU(1),e.qZA()}if(2&n){const t=e.oxw().$implicit,i=e.oxw(3);e.xp6(1),e.hij("Buy (",t.marketplace_listing.depositor_timedout_block-i.currentBlock,")")}}function a(n,o){if(1&n&&(e.TgZ(0,"ion-text"),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit,i=e.oxw(3);e.xp6(1),e.hij("RESERVED (",t.marketplace_listing.depositor_timedout_block-i.currentBlock,")")}}function x(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"ion-button",50),e.NdJ("click",function(){e.CHM(t);const d=e.oxw().$implicit,r=e.oxw(3);return e.KtG(r.cancel(d.marketplace_listing.transaction.hash))}),e._uU(1,"Cancel"),e.qZA()}}function I(n,o){if(1&n&&(e.TgZ(0,"ion-text"),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit,i=e.oxw(3);e.xp6(1),e.hij("RESERVED (",t.marketplace_listing.depositor_timedout_block-i.currentBlock,")")}}function M(n,o){if(1&n&&(e.TgZ(0,"tr",43)(1,"td",44),e._uU(2),e.qZA(),e.TgZ(3,"td",45),e._uU(4),e.ALo(5,"number"),e.ALo(6,"tokenDecimals"),e.ALo(7,"number"),e.ALo(8,"tokenDecimals"),e.qZA(),e.TgZ(9,"td",45),e._uU(10),e.ALo(11,"number"),e.ALo(12,"tokenDecimals"),e.qZA(),e.TgZ(13,"td",45),e._uU(14),e.ALo(15,"number"),e.ALo(16,"tokenDecimals"),e.ALo(17,"number"),e.ALo(18,"tokenDecimals"),e.qZA(),e.TgZ(19,"td",45),e._uU(20),e.ALo(21,"number"),e.qZA(),e.TgZ(22,"td"),e._uU(23),e.ALo(24,"dateAgo"),e.qZA(),e.TgZ(25,"td",46),e.YNc(26,h,2,0,"ion-button",47)(27,c,2,1,"ion-button",47)(28,a,2,1,"ion-text",7)(29,x,2,0,"ion-button",48)(30,I,2,1,"ion-text",7),e.qZA()()),2&n){const t=o.$implicit,i=e.oxw(3);e.xp6(2),e.Oqu(t.id),e.xp6(2),e.AsE("",e.xi3(5,13,e.xi3(6,16,t.ppt,6),"1.6-6")," ($",e.xi3(7,19,e.xi3(8,22,t.ppt*i.baseTokenUSD,6),"1.6-6"),")"),e.xp6(6),e.Oqu(e.xi3(11,25,e.xi3(12,28,t.amount,i.token.decimals),"1.6-6")),e.xp6(4),e.AsE("",e.xi3(15,31,e.xi3(16,34,t.marketplace_listing.total,6),"1.6-6")," ($",e.xi3(17,37,e.xi3(18,40,t.marketplace_listing.total*i.baseTokenUSD,6),"1.6-6"),")"),e.xp6(6),e.hij("",e.xi3(21,43,t.marketplace_listing.deposit_total/t.marketplace_listing.total*100,"1.1-3"),"% "),e.xp6(3),e.hij(" ",e.lcZ(24,46,t.date_created),""),e.xp6(3),e.Q6J("ngIf",t.marketplace_listing.seller_address!=i.walletAddress&&(!t.marketplace_listing.is_deposited||t.marketplace_listing.depositor_timedout_block<i.currentBlock)),e.xp6(1),e.Q6J("ngIf",t.marketplace_listing.seller_address!=i.walletAddress&&t.marketplace_listing.is_deposited&&t.marketplace_listing.depositor_address==i.walletAddress&&t.marketplace_listing.depositor_timedout_block>i.currentBlock),e.xp6(1),e.Q6J("ngIf",t.marketplace_listing.seller_address!=i.walletAddress&&t.marketplace_listing.is_deposited&&t.marketplace_listing.depositor_address!=i.walletAddress&&t.marketplace_listing.depositor_timedout_block>i.currentBlock),e.xp6(1),e.Q6J("ngIf",t.marketplace_listing.seller_address==i.walletAddress&&(!t.marketplace_listing.is_deposited||t.marketplace_listing.depositor_timedout_block<i.currentBlock)),e.xp6(1),e.Q6J("ngIf",t.marketplace_listing.seller_address==i.walletAddress&&t.marketplace_listing.is_deposited&&t.marketplace_listing.depositor_address!=i.walletAddress&&t.marketplace_listing.depositor_timedout_block>i.currentBlock)}}function y(n,o){1&n&&(e.TgZ(0,"tr")(1,"td",51),e._uU(2,"No listings found"),e.qZA()())}const O=()=>({"min-width":"30rem"}),T=()=>["name","ticker"];function z(n,o){if(1&n&&(e.TgZ(0,"div")(1,"div",29)(2,"h4"),e._uU(3,"Your reserved listings"),e.qZA()(),e.TgZ(4,"p-table",30,25),e.YNc(6,B,21,1,"ng-template",26)(7,M,31,48,"ng-template",27)(8,y,3,0,"ng-template",28),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(4),e.Q6J("value",t.depositedListings)("tableStyle",e.DdM(7,O))("paginator",!0)("rows",10)("showCurrentPageReport",!0)("globalFilterFields",e.DdM(8,T))("defaultSortOrder",-1)}}function Q(n,o){1&n&&(e.TgZ(0,"div",29)(1,"h4"),e._uU(2,"All listings"),e.qZA()())}function X(n,o){if(1&n&&(e.TgZ(0,"tr")(1,"th",31),e._uU(2,"Listing # "),e._UZ(3,"p-sortIcon",32),e.qZA(),e.TgZ(4,"th",33),e._uU(5,"ATOM per Token "),e._UZ(6,"p-sortIcon",34),e.qZA(),e.TgZ(7,"th",35),e._uU(8),e._UZ(9,"p-sortIcon",36),e.qZA(),e.TgZ(10,"th",37),e._uU(11,"Total ATOM "),e._UZ(12,"p-sortIcon",38),e.qZA(),e.TgZ(13,"th",39),e._uU(14,"Minimum Deposit "),e._UZ(15,"p-sortIcon",40),e.qZA(),e.TgZ(16,"th",41),e._uU(17,"Listed "),e._UZ(18,"p-sortIcon",42),e.qZA(),e.TgZ(19,"th"),e._uU(20,"\xa0"),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(8),e.hij("",t.token.ticker," Tokens ")}}function ee(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"ion-button",49),e.NdJ("click",function(){e.CHM(t);const d=e.oxw().$implicit,r=e.oxw(2);return e.KtG(r.deposit(d.marketplace_listing.transaction.hash))}),e._uU(1,"Reserve"),e.qZA()}}function te(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"ion-button",49),e.NdJ("click",function(){e.CHM(t);const d=e.oxw().$implicit,r=e.oxw(2);return e.KtG(r.buy(d.marketplace_listing.transaction.hash))}),e._uU(1),e.qZA()}if(2&n){const t=e.oxw().$implicit,i=e.oxw(2);e.xp6(1),e.hij("Buy (",t.marketplace_listing.depositor_timedout_block-i.currentBlock,")")}}function oe(n,o){if(1&n&&(e.TgZ(0,"ion-text"),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit,i=e.oxw(2);e.xp6(1),e.hij("RESERVED (",t.marketplace_listing.depositor_timedout_block-i.currentBlock,")")}}function ie(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"ion-button",50),e.NdJ("click",function(){e.CHM(t);const d=e.oxw().$implicit,r=e.oxw(2);return e.KtG(r.cancel(d.marketplace_listing.transaction.hash))}),e._uU(1,"Cancel"),e.qZA()}}function ne(n,o){if(1&n&&(e.TgZ(0,"ion-text"),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit,i=e.oxw(2);e.xp6(1),e.hij("RESERVED (",t.marketplace_listing.depositor_timedout_block-i.currentBlock,")")}}function ae(n,o){if(1&n&&(e.TgZ(0,"tr",43)(1,"td",44),e._uU(2),e.qZA(),e.TgZ(3,"td",45),e._uU(4),e.ALo(5,"number"),e.ALo(6,"tokenDecimals"),e.ALo(7,"number"),e.ALo(8,"tokenDecimals"),e.qZA(),e.TgZ(9,"td",45),e._uU(10),e.ALo(11,"number"),e.ALo(12,"tokenDecimals"),e.qZA(),e.TgZ(13,"td",45),e._uU(14),e.ALo(15,"number"),e.ALo(16,"tokenDecimals"),e.ALo(17,"number"),e.ALo(18,"tokenDecimals"),e.qZA(),e.TgZ(19,"td",45),e._uU(20),e.ALo(21,"number"),e.qZA(),e.TgZ(22,"td"),e._uU(23),e.ALo(24,"dateAgo"),e.qZA(),e.TgZ(25,"td",46),e.YNc(26,ee,2,0,"ion-button",47)(27,te,2,1,"ion-button",47)(28,oe,2,1,"ion-text",7)(29,ie,2,0,"ion-button",48)(30,ne,2,1,"ion-text",7),e.qZA()()),2&n){const t=o.$implicit,i=e.oxw(2);e.xp6(2),e.Oqu(t.id),e.xp6(2),e.AsE("",e.xi3(5,13,e.xi3(6,16,t.ppt,6),"1.6-6")," ($",e.xi3(7,19,e.xi3(8,22,t.ppt*i.baseTokenUSD,6),"1.6-6"),")"),e.xp6(6),e.Oqu(e.xi3(11,25,e.xi3(12,28,t.amount,i.token.decimals),"1.6-6")),e.xp6(4),e.AsE("",e.xi3(15,31,e.xi3(16,34,t.marketplace_listing.total,6),"1.6-6")," ($",e.xi3(17,37,e.xi3(18,40,t.marketplace_listing.total*i.baseTokenUSD,6),"1.6-6"),")"),e.xp6(6),e.hij("",e.xi3(21,43,t.marketplace_listing.deposit_total/t.marketplace_listing.total*100,"1.1-6"),"% "),e.xp6(3),e.hij(" ",e.lcZ(24,46,t.date_created),""),e.xp6(3),e.Q6J("ngIf",t.marketplace_listing.seller_address!=i.walletAddress&&(!t.marketplace_listing.is_deposited||t.marketplace_listing.depositor_timedout_block<i.currentBlock)),e.xp6(1),e.Q6J("ngIf",t.marketplace_listing.seller_address!=i.walletAddress&&t.marketplace_listing.is_deposited&&t.marketplace_listing.depositor_address==i.walletAddress&&t.marketplace_listing.depositor_timedout_block>i.currentBlock),e.xp6(1),e.Q6J("ngIf",t.marketplace_listing.seller_address!=i.walletAddress&&t.marketplace_listing.is_deposited&&t.marketplace_listing.depositor_address!=i.walletAddress&&t.marketplace_listing.depositor_timedout_block>i.currentBlock),e.xp6(1),e.Q6J("ngIf",t.marketplace_listing.seller_address==i.walletAddress&&(!t.marketplace_listing.is_deposited||t.marketplace_listing.depositor_timedout_block<i.currentBlock)),e.xp6(1),e.Q6J("ngIf",t.marketplace_listing.seller_address==i.walletAddress&&t.marketplace_listing.is_deposited&&t.marketplace_listing.depositor_address!=i.walletAddress&&t.marketplace_listing.depositor_timedout_block>i.currentBlock)}}function le(n,o){1&n&&(e.TgZ(0,"tr")(1,"td",51),e._uU(2,"No listings found"),e.qZA()())}function se(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",16)(1,"ion-grid")(2,"ion-row")(3,"ion-col",17)(4,"div",18)(5,"span",19),e._uU(6," ATOM / USD "),e.qZA(),e.TgZ(7,"span",20),e._uU(8),e.ALo(9,"number"),e.qZA()()(),e.TgZ(10,"ion-col",17)(11,"div",18)(12,"span",19),e._uU(13),e.qZA(),e.TgZ(14,"span",20),e._uU(15),e.ALo(16,"tokenDecimals"),e.ALo(17,"number"),e.ALo(18,"tokenDecimals"),e.qZA()()(),e.TgZ(19,"ion-col",17)(20,"div",18)(21,"span",19),e._uU(22," 24H Volume "),e.qZA(),e.TgZ(23,"span",20),e._uU(24),e.ALo(25,"number"),e.ALo(26,"tokenDecimals"),e.ALo(27,"number"),e.ALo(28,"tokenDecimals"),e.qZA()()()(),e.TgZ(29,"ion-row")(30,"ion-col",21)(31,"ion-button",22),e.NdJ("click",function(){e.CHM(t);const d=e.oxw();return e.KtG(d.listSale())}),e._uU(32),e.qZA()()()(),e.YNc(33,z,9,9,"div",7),e.TgZ(34,"div"),e.YNc(35,Q,3,0,"div",23),e.TgZ(36,"p-table",24,25),e.NdJ("sortFunction",function(d){e.CHM(t);const r=e.oxw();return e.KtG(r.customSort(d))}),e.YNc(38,X,21,1,"ng-template",26)(39,ae,31,48,"ng-template",27)(40,le,3,0,"ng-template",28),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(8),e.hij(" $",e.xi3(9,17,t.baseTokenUSD,"1.2-6")," "),e.xp6(5),e.hij(" ",t.token.ticker," / ATOM "),e.xp6(2),e.AsE(" ",e.xi3(16,20,t.token.last_price_base,t.token.decimals)," ATOM ($",e.xi3(17,23,t.baseTokenUSD*e.xi3(18,26,t.token.last_price_base,t.token.decimals),"1.2-6"),") "),e.xp6(9),e.AsE(" ",e.xi3(25,29,e.xi3(26,32,t.token.volume_24_base,6),"1.2-6")," ATOM ($",e.xi3(27,35,t.baseTokenUSD*e.xi3(28,38,t.token.volume_24_base,6),"1.2-6"),") "),e.xp6(8),e.hij("Sell ",t.token.ticker," tokens"),e.xp6(1),e.Q6J("ngIf",t.depositedListings.length>0),e.xp6(2),e.Q6J("ngIf",t.depositedListings.length>0),e.xp6(1),e.Q6J("customSort",!0)("value",t.listings)("tableStyle",e.DdM(41,O))("paginator",!0)("rows",10)("showCurrentPageReport",!0)("globalFilterFields",e.DdM(42,T))("defaultSortOrder",1)}}class G{constructor(o,t,i,d,r,m){this.activatedRoute=o,this.protocolService=t,this.modalCtrl=i,this.alertController=d,this.walletService=r,this.priceService=m,this.isLoading=!1,this.explorerTxUrl=u.N.api.explorer,this.tokenIsLaunched=!1,this.baseTokenUSD=0,this.walletAddress="",this.currentBlock=0,this.limit=2e3,this.loadingListing=!1,this.tokenLaunchDate=new Date}ngOnInit(){var o=this;return(0,b.Z)(function*(){o.isLoading=!0,(yield o.walletService.isConnected())&&(o.walletAddress=(yield o.walletService.getAccount()).address);const i=(0,v.qo)(u.N.api.endpoint),d=yield i("query")({token:[{where:{ticker:{_eq:o.activatedRoute.snapshot.params.quote.toUpperCase()}}},{id:!0,height:!0,transaction:{hash:!0},creator:!0,current_owner:!0,name:!0,ticker:!0,decimals:!0,max_supply:!0,per_mint_limit:!0,launch_timestamp:!0,content_path:!0,content_size_bytes:!0,circulating_supply:!0,last_price_base:!0,volume_24_base:!0,date_created:!0}]});o.token=d.token[0];const r=yield i("query")({status:[{where:{chain_id:{_eq:u.N.chain.chainId}}},{base_token:!0,base_token_usd:!0,last_processed_height:!0}]});o.baseTokenUSD=r.status[0].base_token_usd,o.currentBlock=r.status[0].last_processed_height,yield Promise.all([i("query")({marketplace_cft20_detail:[{where:{token_id:{_eq:o.token.id},marketplace_listing:{is_cancelled:{_eq:!1},is_filled:{_eq:!1}}},limit:o.limit,order_by:[{ppt:"asc"}]},{id:!0,marketplace_listing:{seller_address:!0,total:!0,depositor_address:!0,is_deposited:!0,depositor_timedout_block:!0,deposit_total:!0,transaction:{hash:!0}},ppt:!0,amount:!0,date_created:!0}]}).then(_=>o.listings=_.marketplace_cft20_detail),i("query")({marketplace_cft20_detail:[{where:{token_id:{_eq:o.token.id},marketplace_listing:{is_cancelled:{_eq:!1},is_filled:{_eq:!1},is_deposited:{_eq:!0},depositor_address:{_eq:o.walletAddress},depositor_timedout_block:{_gt:o.currentBlock}}},limit:o.limit},{id:!0,marketplace_listing:{seller_address:!0,total:!0,depositor_address:!0,is_deposited:!0,depositor_timedout_block:!0,deposit_total:!0,transaction:{hash:!0}},ppt:!0,amount:!0,date_created:!0}]}).then(_=>o.depositedListings=_.marketplace_cft20_detail)]);const m=(0,v.w0)(u.N.api.wss);m("subscription")({status:[{where:{chain_id:{_eq:u.N.chain.chainId}}},{base_token:!0,base_token_usd:!0,last_processed_height:!0}]}).on(({status:_})=>{o.baseTokenUSD=_[0].base_token_usd,o.currentBlock=_[0].last_processed_height}),m("subscription")({marketplace_cft20_detail:[{where:{token_id:{_eq:o.token.id},marketplace_listing:{is_cancelled:{_eq:!1},is_filled:{_eq:!1}}},limit:o.limit},{id:!0,marketplace_listing:{seller_address:!0,total:!0,depositor_address:!0,is_deposited:!0,depositor_timedout_block:!0,deposit_total:!0,transaction:{hash:!0}},ppt:!0,amount:!0,date_created:!0}]}).on(({marketplace_cft20_detail:_})=>{o.listings=_}),m("subscription")({marketplace_cft20_detail:[{where:{token_id:{_eq:o.token.id},marketplace_listing:{is_cancelled:{_eq:!1},is_filled:{_eq:!1},is_deposited:{_eq:!0},depositor_address:{_eq:o.walletAddress},depositor_timedout_block:{_gt:o.currentBlock}}},limit:o.limit},{id:!0,marketplace_listing:{seller_address:!0,total:!0,depositor_address:!0,is_deposited:!0,depositor_timedout_block:!0,deposit_total:!0,transaction:{hash:!0}},ppt:!0,amount:!0,date_created:!0}]}).on(({marketplace_cft20_detail:_})=>{o.depositedListings=_}),o.isLoading=!1})()}deposit(o){var t=this;return(0,b.Z)(function*(){t.loadingListing="Loading listing...";const d=yield(0,v.qo)(u.N.api.endpoint)("query")({marketplace_listing:[{where:{transaction:{hash:{_eq:o}}}},{seller_address:!0,total:!0,deposit_total:!0,is_deposited:!0,is_cancelled:!0,is_filled:!0}]});if(t.loadingListing=!1,0==d.marketplace_listing.length)return void alert("Listing not found");const r=d.marketplace_listing[0],m=r.deposit_total,_={typeUrl:"/cosmos.bank.v1beta1.MsgSend",value:U.MsgSend.encode({fromAddress:(yield t.walletService.getAccount()).address,toAddress:r.seller_address,amount:[{denom:"uatom",amount:m.toString()}]}).finish()},g={"@type":"/cosmos.bank.v1beta1.MsgSend",from_address:(yield t.walletService.getAccount()).address,to_address:r.seller_address,amount:[{denom:"uatom",amount:m.toString()}]},k=new Map([["h",o]]),$=t.protocolService.buildURN(u.N.chain.chainId,"deposit",k);(yield t.modalCtrl.create({keyboardClose:!0,backdropDismiss:!1,component:P.l,componentProps:{urn:$,metadata:null,data:null,routerLink:["/app/market",t.token.ticker],resultCTA:"Back to market",metaprotocol:"marketplace",metaprotocolAction:"deposit",messages:[_],messagesJSON:[g]}})).present()})()}buy(o){var t=this;return(0,b.Z)(function*(){t.loadingListing="Loading listing...";const d=yield(0,v.qo)(u.N.api.endpoint)("query")({marketplace_listing:[{where:{transaction:{hash:{_eq:o}}}},{seller_address:!0,total:!0,deposit_total:!0,is_deposited:!0,is_cancelled:!0,is_filled:!0}]});if(t.loadingListing=!1,0==d.marketplace_listing.length)return void alert("Listing not found");const r=d.marketplace_listing[0];if(!t.walletService.hasWallet())return void(yield t.modalCtrl.create({keyboardClose:!0,backdropDismiss:!0,component:q.f,cssClass:"wallet-required-modal"})).present();let m=r.total;const _=r.deposit_total;_>m?m=BigInt(1):m-=_;let g=parseFloat(m.toString())/10**t.token.decimals;const k={typeUrl:"/cosmos.bank.v1beta1.MsgSend",value:U.MsgSend.encode({fromAddress:(yield t.walletService.getAccount()).address,toAddress:r.seller_address,amount:[{denom:"uatom",amount:m.toString()}]}).finish()},$={"@type":"/cosmos.bank.v1beta1.MsgSend",from_address:(yield t.walletService.getAccount()).address,to_address:r.seller_address,amount:[{denom:"uatom",amount:m.toString()}]};let j=u.N.fees.protocol.marketplace["buy.cft20"].amount;if("dynamic-percent"==u.N.fees.protocol.marketplace["buy.cft20"].type){let w=g*parseFloat(u.N.fees.protocol.marketplace["buy.cft20"].amount);w<1e-6&&(w=1e-6),w*=10**t.token.decimals,j=w.toFixed(0)}const re=new Map([["h",o]]),_e=t.protocolService.buildURN(u.N.chain.chainId,"buy.cft20",re);(yield t.modalCtrl.create({keyboardClose:!0,backdropDismiss:!1,component:P.l,componentProps:{urn:_e,metadata:null,data:null,routerLink:["/app/market",t.token.ticker],resultCTA:"Back to market",metaprotocol:"marketplace",metaprotocolAction:"buy.cft20",messages:[k],messagesJSON:[$],overrideFee:j}})).present()})()}cancel(o){var t=this;return(0,b.Z)(function*(){if(!t.walletService.hasWallet())return void(yield t.modalCtrl.create({keyboardClose:!0,backdropDismiss:!0,component:q.f,cssClass:"wallet-required-modal"})).present();const i=new Map([["h",o]]),d=t.protocolService.buildURN(u.N.chain.chainId,"delist",i);(yield t.modalCtrl.create({keyboardClose:!0,backdropDismiss:!1,component:P.l,componentProps:{urn:d,metadata:null,data:null,routerLink:["/app/market",t.token.ticker],resultCTA:"Back to market",metaprotocol:"marketplace",metaprotocolAction:"delist"}})).present()})()}listSale(){var o=this;return(0,b.Z)(function*(){(yield o.modalCtrl.create({keyboardClose:!0,backdropDismiss:!0,component:S.t,componentProps:{ticker:o.token.ticker}})).present()})()}customSort(o){var t,i,d;(console.log(o.field),"marketplace_listing.total"==o.field)&&(null===(i=o.data)||void 0===i||i.sort((r,m)=>{let _=parseInt(r.marketplace_listing.total),g=parseInt(m.marketplace_listing.total),k=null;return k=null==_&&null!=g?-1:null!=_&&null==g?1:null==_&&null==g?0:_<g?-1:_>g?1:0,o.order*k}));"marketplace_listing.deposit_total"==o.field&&(null===(d=o.data)||void 0===d||d.sort((r,m)=>{let _=parseInt(r.marketplace_listing.deposit_total)/parseInt(r.marketplace_listing.total),g=parseInt(m.marketplace_listing.deposit_total)/parseInt(m.marketplace_listing.total),k=null;return k=null==_&&null!=g?-1:null!=_&&null==g?1:null==_&&null==g?0:_<g?-1:_>g?1:0,o.order*k}));null===(t=o.data)||void 0===t||t.sort((r,m)=>{let _=r[o.field],g=m[o.field],k=null;return k=null==_&&null!=g?-1:null!=_&&null==g?1:null==_&&null==g?0:"string"==typeof _&&"string"==typeof g?_.localeCompare(g):_<g?-1:_>g?1:0,o.order*k})}}(L=G).\u0275fac=function(o){return new(o||L)(e.Y36(N.gz),e.Y36(F.J),e.Y36(s.IN),e.Y36(s.Br),e.Y36(J.X),e.Y36(K.N))},L.\u0275cmp=e.Xpm({type:L,selectors:[["app-trade-token-v2"]],standalone:!0,features:[e.jDz],decls:19,vars:4,consts:[["fullscreen","true"],[3,"isOpen"],["style","padding:50px"],["size","12","offset","0","size-md","12","offset-md","0","size-md","10","offset-md","1","size-xl","10","offset-xl","1"],[1,"no-shadow"],["slot","start"],["defaultHref","/app/markets"],[4,"ngIf"],["size","12","offset","0","size-md","12","offset-md","0","size-md","10","offset-md","1","size-xl","10","offset-xl","1",1,"main-content"],["class","loading p-4",4,"ngIf"],["class","aligned",4,"ngIf"],[2,"height","100px"],[2,"padding","50px","--background","hsla(0, 0%, 100%, .05) !important","background-color","hsla(0, 0%, 100%, .05) !important","backdrop-filter","blur(50px) !important"],[2,"margin","0px 40px 0 40px"],[1,"loading","p-4"],["type","indeterminate"],[1,"aligned"],["size","12","size-lg","4"],[1,"token-stats"],[1,"key"],[1,"value","ms-3"],["size","12",1,"text-end"],["color","primary","fill","outline",3,"click"],["class","mb-3",4,"ngIf"],["currentPageReportTemplate","Showing {first} to {last} of {totalRecords} listings","styleClass","token-list","sortField","ppt",3,"customSort","value","tableStyle","paginator","rows","showCurrentPageReport","globalFilterFields","defaultSortOrder","sortFunction"],["data",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"mb-3"],["currentPageReportTemplate","Showing {first} to {last} of {totalRecords} listings","styleClass","token-list","sortField","id",3,"value","tableStyle","paginator","rows","showCurrentPageReport","globalFilterFields","defaultSortOrder"],["pSortableColumn","id","pFrozenColumn",""],["field","id"],["pSortableColumn","ppt"],["field","ppt"],["pSortableColumn","amount"],["field","amount"],["pSortableColumn","marketplace_listing.total"],["field","marketplace_listing.total"],["pSortableColumn","marketplace_listing.deposit_total"],["field","marketplace_listing.deposit_total"],["pSortableColumn","date_created"],["field","date_created"],[1,"no-click"],["pFrozenColumn",""],[1,"mono"],[1,"text-end"],["fill","outline","color","success",3,"click",4,"ngIf"],["fill","outline","color","warning",3,"click",4,"ngIf"],["fill","outline","color","success",3,"click"],["fill","outline","color","warning",3,"click"],["colspan","4"]],template:function(o,t){1&o&&(e.TgZ(0,"ion-content",0)(1,"ion-modal",1),e.YNc(2,W,20,1,"ng-template",2),e.qZA(),e.TgZ(3,"ion-grid")(4,"ion-row")(5,"ion-col",3)(6,"ion-header",4)(7,"ion-toolbar")(8,"ion-buttons",5),e._UZ(9,"ion-menu-button")(10,"ion-back-button",6),e.qZA(),e.TgZ(11,"ion-title"),e.YNc(12,V,2,1,"span",7),e._uU(13," / ATOM Market "),e.qZA()()()()(),e.TgZ(14,"ion-row")(15,"ion-col",8),e.YNc(16,Y,4,0,"div",9)(17,se,41,43,"div",10),e._UZ(18,"div",11),e.qZA()()()()),2&o&&(e.xp6(1),e.Q6J("isOpen",t.loadingListing),e.xp6(11),e.Q6J("ngIf",!t.isLoading),e.xp6(4),e.Q6J("ngIf",t.isLoading),e.xp6(1),e.Q6J("ngIf",!t.isLoading))},dependencies:[s.Pc,s.YG,s.Sm,s.wI,s.W2,s.jY,s.Gu,s.fG,s.X7,s.Nd,s.yW,s.wd,s.sr,s.ki,s.oU,f.ez,f.O5,f.JJ,p.u5,A.u,Z.U$,Z.iA,C.jx,Z.lQ,Z.on,Z.fz,D.R],styles:["h1[_ngcontent-%COMP%]{font-size:36px}.meta[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:14px;color:#ddd;font-weight:600;display:block}.meta[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:14px;color:#fff;font-weight:400;display:block}.meta[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--color-teal)}.token-holdings-list[_ngcontent-%COMP%]{margin-left:0;margin-bottom:50px}.token-holdings-list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{padding:5px;cursor:pointer;border-bottom:1px solid rgba(119,119,119,.2)}.token-holdings-list[_ngcontent-%COMP%]   .item.interactable[_ngcontent-%COMP%]{color:#ccc}.token-holdings-list[_ngcontent-%COMP%]   .item.interactable[_ngcontent-%COMP%]:hover{color:#57aaa7}.token-holdings-list[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{text-align:right}.token-stats[_ngcontent-%COMP%]{background-color:#0003;border-radius:10px;padding:10px}.token-stats[_ngcontent-%COMP%]   .key[_ngcontent-%COMP%]{font-weight:600;color:#ffffffe6}.token-stats[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#fff9}"]})}}]);